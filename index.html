<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple Polylines</title>
    <style>

      #map {
        height: 100%;
      }

      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="map"></div>
    <script>
    var map;
    var infowindow;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 7,
          center: {lat: 50, lng: 14},
          mapTypeId: 'terrain'
        });
        infowindow = new google.maps.InfoWindow();

        var routeData = [{"lat":50.657667,"lng":13.998167,"time":"2016-10-25T16:22:45+0000"},{"lat":50.65835,"lng":14,"time":"2016-10-25T16:22:55+0000"},{"lat":50.65865,"lng":14.002,"time":"2016-10-25T16:23:11+0000"},{"lat":50.65865,"lng":14.002,"time":"2016-10-25T16:23:25+0000"},{"lat":50.65865,"lng":14.002,"time":"2016-10-25T16:23:41+0000"},{"lat":50.6598,"lng":14.011167,"time":"2016-10-25T16:23:56+0000"},{"lat":50.6598,"lng":14.011167,"time":"2016-10-25T16:24:12+0000"},{"lat":50.6598,"lng":14.011167,"time":"2016-10-25T16:24:27+0000"},{"lat":50.6598,"lng":14.011167,"time":"2016-10-25T16:24:42+0000"},{"lat":50.6623,"lng":14.021167,"time":"2016-10-25T16:25:08+0000"},{"lat":50.663383,"lng":14.025167,"time":"2016-10-25T16:25:15+0000"},{"lat":50.663667,"lng":14.026333,"time":"2016-10-25T16:25:27+0000"},{"lat":50.663767,"lng":14.026667,"time":"2016-10-25T16:25:37+0000"},{"lat":50.66435,"lng":14.028833,"time":"2016-10-25T16:25:52+0000"},{"lat":50.6649,"lng":14.029333,"time":"2016-10-25T16:26:05+0000"},{"lat":50.665583,"lng":14.0285,"time":"2016-10-25T16:26:18+0000"},{"lat":50.665583,"lng":14.0285,"time":"2016-10-25T16:26:31+0000"},{"lat":50.666883,"lng":14.029333,"time":"2016-10-25T16:26:40+0000"},{"lat":50.666883,"lng":14.029333,"time":"2016-10-25T16:26:53+0000"},{"lat":50.667433,"lng":14.029833,"time":"2016-10-25T16:27:14+0000"},{"lat":50.667967,"lng":14.030333,"time":"2016-10-25T16:27:22+0000"},{"lat":50.66825,"lng":14.030667,"time":"2016-10-25T16:27:26+0000"},{"lat":50.668483,"lng":14.031,"time":"2016-10-25T16:27:29+0000"},{"lat":50.66885,"lng":14.030833,"time":"2016-10-25T16:27:34+0000"},{"lat":50.669167,"lng":14.030167,"time":"2016-10-25T16:27:38+0000"},{"lat":50.669517,"lng":14.029667,"time":"2016-10-25T16:27:42+0000"},{"lat":50.670217,"lng":14.028833,"time":"2016-10-25T16:27:49+0000"},{"lat":50.670633,"lng":14.029167,"time":"2016-10-25T16:27:55+0000"},{"lat":50.6712,"lng":14.029833,"time":"2016-10-25T16:28:05+0000"},{"lat":50.6712,"lng":14.029833,"time":"2016-10-25T16:28:18+0000"},{"lat":50.6725,"lng":14.027833,"time":"2016-10-25T16:28:28+0000"},{"lat":50.6725,"lng":14.027833,"time":"2016-10-25T16:28:42+0000"},{"lat":50.6725,"lng":14.027833,"time":"2016-10-25T16:28:58+0000"},{"lat":50.6758,"lng":14.030667,"time":"2016-10-25T16:29:02+0000"},{"lat":50.676083,"lng":14.0315,"time":"2016-10-25T16:30:10+0000"},{"lat":50.676083,"lng":14.0315,"time":"2016-10-25T16:30:23+0000"},{"lat":50.677217,"lng":14.034333,"time":"2016-10-25T16:30:26+0000"},{"lat":50.67755,"lng":14.034833,"time":"2016-10-25T16:30:29+0000"},{"lat":50.678017,"lng":14.0355,"time":"2016-10-25T16:30:35+0000"},{"lat":50.678967,"lng":14.036667,"time":"2016-10-25T16:30:46+0000"},{"lat":50.679433,"lng":14.037,"time":"2016-10-25T16:30:53+0000"},{"lat":50.680217,"lng":14.036833,"time":"2016-10-25T16:31:05+0000"},{"lat":50.6814,"lng":14.037333,"time":"2016-10-25T16:31:10+0000"},{"lat":50.681967,"lng":14.037333,"time":"2016-10-25T16:31:17+0000"},{"lat":50.682833,"lng":14.037667,"time":"2016-10-25T16:31:23+0000"},{"lat":50.683633,"lng":14.038333,"time":"2016-10-25T16:31:31+0000"},{"lat":50.684433,"lng":14.039333,"time":"2016-10-25T16:31:38+0000"},{"lat":50.684433,"lng":14.039333,"time":"2016-10-25T16:31:49+0000"},{"lat":50.684433,"lng":14.039333,"time":"2016-10-25T16:32:16+0000"},{"lat":50.6883,"lng":14.046,"time":"2016-10-25T16:32:37+0000"},{"lat":50.688917,"lng":14.046333,"time":"2016-10-25T16:32:41+0000"},{"lat":50.68935,"lng":14.045333,"time":"2016-10-25T16:32:53+0000"},{"lat":50.689317,"lng":14.044667,"time":"2016-10-25T16:33:10+0000"},{"lat":50.689317,"lng":14.044833,"time":"2016-10-25T16:33:25+0000"}];
          var allPoints = "";
          var str = '';
          str+='<?xml version="1.0" encoding="UTF-8" standalone="no" ?>';
          str+='<gpx xmlns="http://www.topografix.com/GPX/1/1" xmlns:gpxx="http://www.garmin.com/xmlschemas/GpxExtensions/v3" xmlns:gpxtpx="http://www.garmin.com/xmlschemas/TrackPointExtension/v1" creator="Oregon 400t" version="1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd http://www.garmin.com/xmlschemas/GpxExtensions/v3 http://www.garmin.com/xmlschemas/GpxExtensionsv3.xsd http://www.garmin.com/xmlschemas/TrackPointExtension/v1 http://www.garmin.com/xmlschemas/TrackPointExtensionv1.xsd">';
          str+='<metadata>';
          str+='<link href="http://www.eclubprague.com">';
          str+='<text>eClubPrague</text>'
          str+='</link>'
          str+='<time>2016-10-17T22:58:43Z</time>'
          str+='</metadata>'
          str+='<trk>';
          str+='<name>Route</name>';
          str+='<trkseg>';
          for(var i = 0; i<routeData.length; i++) {
            str+='<trkpt lat="'+routeData[i].lat+'" lon="'+routeData[i].lng+'">\n';
            str+='<time>'+routeData[i].time.substr(0, routeData[i].time.indexOf('+'))+'Z</time>\n';
            str+='</trkpt>\n';
            if(i != 0) {
              allPoints+="&";
            }
 //           if(i == 35 || i == 34 || i == 36)
 //             continue;
            createMarker(routeData[i],i+"");
            allPoints+="point="+routeData[i].lat+","+routeData[i].lng;
          }

          str+='</trkseg>';
          str+='</trk>';
          str+='</gpx>';

        /*$.get("https://iot.eclubprague.com/graphhopper-api/match/?"+allPoints+"&points_encoded=false&instructions=false&calc_points=true", function(data) {
        	     var route = [];

                data.paths[0].points.coordinates.forEach(function(point){
                  var tmp = {};
                  tmp.lat=point[1];
                  tmp.lng=point[0];

                  route.push(tmp);
                });
        	
        		console.log("Path length",data.paths[0].distance/1000.0,"km");
        		console.log("Time needed",data.paths[0].time/3600000,"hours");

				        var flightPath = new google.maps.Polyline({
				          path: route,
				          geodesic: true,
				          strokeColor: '#FF0000',
				          strokeOpacity: 1.0,
				          strokeWeight: 2
				        });

	        			flightPath.setMap(map);
    


        }, "json" );*/
        console.log(str);
        $.ajax({
          type: "post",
          url: "https://iot.eclubprague.com/graphhopper-api/match/?points_encoded=false",
          accepts: "application/json",
          data: str,
          contentType: "application/gpx+xml",
          success: function(data, status, object) {
            var route = [];

                data.paths[0].points.coordinates.forEach(function(point){
                  var tmp = {};
                  tmp.lat=point[1];
                  tmp.lng=point[0];

                  route.push(tmp);
                });
          
            console.log("Path length",data.paths[0].distance/1000.0,"km");
            console.log("Time needed",data.paths[0].time/3600000,"hours");

                var flightPath = new google.maps.Polyline({
                  path: route,
                  geodesic: true,
                  strokeColor: '#FF0000',
                  strokeOpacity: 1.0,
                  strokeWeight: 2
                });

                flightPath.setMap(map);
          },

          dataType: "json"
        });

        


        
      }

      function createMarker(place, index) {
      var placeLoc = place;
      var marker = new google.maps.Marker({
        map: map,
        position: place
      });
      google.maps.event.addListener(marker, 'click', function() {
        infowindow.setContent(index)
        infowindow.open(map, this);
      });
    }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBr7-_P3IYkeqM7leMjfX27ZDO7VoGmiZM&callback=initMap">
    </script>
  </body>
</html>